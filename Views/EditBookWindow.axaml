<Window xmlns="https://github.com/avaloniaui"
		xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
		xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
		xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
		xmlns:vm="clr-namespace:SigmaLib.ViewModels"
		xmlns:conv="clr-namespace:SigmaLib.Converters"
		mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
		Title="Редактировать книгу"
		WindowStartupLocation="CenterOwner"
		MinWidth="1100"
		MinHeight="500"
		x:Class="SigmaLib.EditBookWindow"
		x:DataType="vm:EditBookViewModel">
	<Window.Resources>
		<conv:CountToVisibilityConverter x:Key="CountToBool"/>
		<conv:BoolToBrushConverter x:Key="BoolToBrush"/>
		<conv:StringIsNotEmptyToBoolConverter x:Key="StringToBool"/>
	</Window.Resources>
	<Grid ColumnDefinitions="*,*"
		  RowDefinitions="Auto,*"
		  Margin="20"
		  ColumnSpacing="30"
		  RowSpacing="20">

		<!-- Левая часть: свойства книги -->
		<Border Grid.Column="0"
				Grid.Row="0"
				Grid.RowSpan="2"
				Padding="20"
				Background="#f8f9fa"
				CornerRadius="8"
				BorderBrush="#e9ecef"
				BorderThickness="1">
			<Grid RowDefinitions="Auto,Auto,Auto,Auto,Auto,Auto,Auto,Auto,*"
				  ColumnDefinitions="Auto,*"
				  ColumnSpacing="15"
				  RowSpacing="12">

				<!-- Заголовок -->
				<TextBlock Grid.Row="0"
						   Grid.ColumnSpan="2"
						   Text="Свойства книги"
						   FontSize="16"
						   FontWeight="Bold"
						   Margin="0,0,0,10"
						   Foreground="#212529"/>

				<TextBlock Grid.Row="1" Grid.Column="0"
						   Text="Название:"
						   VerticalAlignment="Center"/>
				<TextBlock Grid.Row="1" Grid.Column="1"
						   Text="{Binding CurrentBook.Title}"
						   Padding="8,6"/>

				<TextBlock Grid.Row="2" Grid.Column="0"
						   Text="Автор:"
						   VerticalAlignment="Center"/>
				<TextBlock Grid.Row="2" Grid.Column="1"
						   Text="{Binding CurrentBook.Author}"
						   Padding="8,6"/>

				<TextBlock Grid.Row="3" Grid.Column="0"
						   Text="Год издания:"
						   VerticalAlignment="Center"/>
				<TextBlock Grid.Row="3" Grid.Column="1"
						   Text="{Binding CurrentBook.Year}"
						   Padding="8,6"/>

				<TextBlock Grid.Row="4" Grid.Column="0"
						   Text="Жанр:"
						   VerticalAlignment="Center"/>
				<TextBlock Grid.Row="4" Grid.Column="1"
						   Text="{Binding CurrentBook.Genre}"
						   Padding="8,6"/>

				<TextBlock Grid.Row="5" Grid.Column="0"
						   Text="Штраф за день:"
						   VerticalAlignment="Center"
						   ToolTip.Tip="Штраф за просрочку в день"/>
				<NumericUpDown Grid.Row="5" Grid.Column="1"
							   Value="{Binding CurrentBook.Price, Mode=TwoWay}"
							   Minimum="0"
							   Maximum="100000"
							   Increment="0,5"
							   ShowButtonSpinner="True"/>

				<TextBlock Grid.Row="6" Grid.Column="0"
						   Text="Количество копий:"
						   VerticalAlignment="Center"/>
				<StackPanel Grid.Row="6" Grid.Column="1" Orientation="Horizontal" Spacing="8">
					<!-- Отображение текущего количества копий -->
					<TextBlock Text="{Binding CurrentBook.TotalCopies}" VerticalAlignment="Center"/>

					<!-- Кнопка "Добавить копию" -->
					<Button Content="Добавить копию"
							VerticalAlignment="Center"
							Command="{Binding AddBookCopyCommand}"/>
				</StackPanel>

				<!-- Чекбокс можно бронировать -->
				<CheckBox Grid.Row="7"
						  Grid.Column="0"
						  Grid.ColumnSpan="2"
						  Content="Можно бронировать"
						  IsChecked="{Binding CurrentBook.IsReservable}"
						  VerticalAlignment="Center"
						  Margin="0,10,0,0"/>

				<!-- Кнопки -->
				<StackPanel Grid.Row="8"
							Grid.ColumnSpan="2"
							Orientation="Horizontal"
							HorizontalAlignment="Right"
							Spacing="10"
							Margin="0,25,0,0">
					<Button Content="Изменить книгу"
							Command="{Binding EditBookCommand}"
							Padding="15,8"
							Background="#007bff"
							Foreground="White"
							BorderThickness="0"
							CornerRadius="4"
							Cursor="Hand"
							FontWeight="SemiBold"/>
					<Button Content="Отмена"
							Command="{Binding CancelCommand}"
							Padding="15,8"
							Background="#6c757d"
							Foreground="White"
							BorderThickness="0"
							CornerRadius="4"
							Cursor="Hand"/>
				</StackPanel>
			</Grid>
		</Border>

		<!-- Правая часть: список копий -->
		<Border Grid.Column="1"
				Grid.Row="0"
				Grid.RowSpan="2"
				Padding="20"
				Background="#f8f9fa"
				CornerRadius="8"
				BorderBrush="#e9ecef"
				BorderThickness="1">
			<Grid RowDefinitions="Auto,*">
				<!-- Заголовок -->
				<StackPanel Grid.Row="0"
							Orientation="Horizontal"
							Spacing="10"
							Margin="0,0,0,15"
							VerticalAlignment="Center">
					<TextBlock Text="📚"
							   FontSize="18"
							   VerticalAlignment="Center"/>
					<TextBlock Text="Экземпляры книги"
							   FontSize="16"
							   FontWeight="Bold"
							   VerticalAlignment="Center"
							   Foreground="#212529"/>
					<TextBlock Text="{Binding BookCopies.Count}"
							   FontSize="14"
							   FontWeight="SemiBold"
							   Foreground="#495057"
							   VerticalAlignment="Center"
							   Margin="5,0,0,0"/>
				</StackPanel>

				<!-- Список старых копий -->

				<ScrollViewer Grid.Row="1"
							  VerticalScrollBarVisibility="Auto"
							  HorizontalScrollBarVisibility="Disabled"
							  Padding="0,5,0,0">
					<StackPanel>
						<TextBlock Text="Старые экземпляры" FontWeight="Bold" Margin="0,0,0,8"/>
						<ItemsControl ItemsSource="{Binding BookCopies}"
									  Margin="0,0,5,0">
							<ItemsControl.ItemTemplate>
								<DataTemplate>
									<Border Padding="12"
											Margin="0,0,0,10"
											Background="White"
											CornerRadius="6"
											BorderBrush="#e9ecef"
											BorderThickness="1">

										<Grid RowDefinitions="Auto,Auto"
											  RowSpacing="10">

											<!-- Верхняя строка с полями -->
											<Grid ColumnDefinitions="Auto,*,Auto,Auto,Auto"
												  ColumnSpacing="10"
												  VerticalAlignment="Center">

												<!-- ID -->
												<StackPanel Grid.Column="0"
															Orientation="Horizontal"
															VerticalAlignment="Center"
															MinWidth="60">
													<TextBlock Text="ID"
															   FontWeight="Bold"
															   Foreground="#6c757d"
															   VerticalAlignment="Center"
															   Margin="0,0,5,0"/>
													<TextBlock Text="{Binding Id}"
															   FontWeight="Bold"
															   Foreground="#495057"
															   VerticalAlignment="Center"
															   MinWidth="25"
															   TextAlignment="Center"/>
												</StackPanel>

												<!-- Позиция в библиотеке -->
												<StackPanel Grid.Column="1"
															Orientation="Vertical"
															VerticalAlignment="Center">
													<TextBlock Text="Позиция"
															   FontWeight="SemiBold"
															   FontSize="11"
															   Foreground="#6c757d"
															   Margin="0,0,0,2"/>
													<TextBox Text="{Binding Location, Mode=TwoWay}"
															 Watermark="Например: Стеллаж 3, Полка 2"
															 Padding="6,5"
															 FontSize="12"
															 BorderBrush="#ced4da"
															 Height="32"/>
												</StackPanel>

												<!-- Состояние книги -->
												<StackPanel Grid.Column="2"
															Orientation="Vertical"
															VerticalAlignment="Center"
															MinWidth="120">
													<TextBlock Text="Состояние"
															   FontWeight="SemiBold"
															   FontSize="11"
															   Foreground="#6c757d"
															   Margin="0,0,0,2"/>
													<ComboBox SelectedItem="{Binding Condition, Mode=TwoWay}"
															  Padding="6,5"
															  FontSize="12"
															  BorderBrush="#ced4da"
															  Height="32">
														<ComboBox.Items>
															<x:String>New</x:String>
															<x:String>Damaged</x:String>
															<x:String>Good</x:String>
															<x:String>Excellent</x:String>
														</ComboBox.Items>
													</ComboBox>
												</StackPanel>

												<!-- Статус -->
												<StackPanel Grid.Column="3"
															Orientation="Vertical"
															VerticalAlignment="Center"
															MinWidth="120">
													<TextBlock Text="Статус"
															   FontWeight="SemiBold"
															   FontSize="11"
															   Foreground="#6c757d"
															   Margin="0,0,0,2"/>
													<ComboBox SelectedItem="{Binding Status, Mode=TwoWay}"
															  Padding="6,5"
															  FontSize="12"
															  BorderBrush="#ced4da"
															  Height="32">
														<ComboBox.Items>
															<x:String>Available</x:String>
															<x:String>Reserved</x:String>
															<x:String>CheckedOut</x:String>
														</ComboBox.Items>
													</ComboBox>
												</StackPanel>

												<!-- Кнопка удаления -->
												<Button Grid.Column="4"
														Command="{Binding $parent[ItemsControl].DataContext.DeleteOldBookCopyCommand}"
														CommandParameter="{Binding}"
														Background="#dc3545"
														Foreground="White"
														BorderBrush="#dc3545"
														Padding="10,6"
														Margin="5,0,0,0"
														VerticalAlignment="Center"
														Height="32"
														Cursor="Hand">
													<StackPanel Orientation="Horizontal"
																VerticalAlignment="Center">
														<Path Data="M19,6.41L17.59,5 12,10.59 6.41,5 5,6.41 10.59,12 5,17.59 6.41,19 12,13.41 17.59,19 19,17.59 13.41,12z"
															  Fill="White"
															  Stretch="Uniform"
															  Width="12"
															  Height="12"
															  Margin="0,0,4,0"/>
														<TextBlock Text="Удалить"
																   FontWeight="SemiBold"
																   FontSize="11"
																   VerticalAlignment="Center"/>
													</StackPanel>
												</Button>
											</Grid>

											<!-- Результат операции для конкретного элемента -->
											<Border Grid.Row="1"
													Background="{Binding IsSuccessOperationResult, Converter={StaticResource BoolToBrush}}"
													Padding="6,5"
													CornerRadius="4"
													Opacity="0.9"
													IsVisible="{Binding StringOperationResult, Converter={StaticResource StringToBool}}"
													VerticalAlignment="Center">
												<TextBlock Text="{Binding StringOperationResult}"
														   Foreground="White"
														   FontWeight="SemiBold"
														   FontSize="10"
														   TextWrapping="Wrap"
														   HorizontalAlignment="Center"
														   VerticalAlignment="Center"/>
											</Border>
										</Grid>
									</Border>
								</DataTemplate>
							</ItemsControl.ItemTemplate>
						</ItemsControl>


						<TextBlock Text="Новые экземпляры" FontWeight="Bold" Margin="16,16,0,8"/>
						<ItemsControl ItemsSource="{Binding NewBookCopies}"
									  Margin="0,0,5,0">
							<ItemsControl.ItemTemplate>
								<DataTemplate>
									<Border Padding="10"
											Margin="0,0,0,10"
											Background="White"
											CornerRadius="6"
											BorderBrush="#e9ecef"
											BorderThickness="1">

										<Grid RowDefinitions="Auto,Auto"
											  RowSpacing="8">

											<!-- Верхняя строка с полями -->
											<Grid ColumnDefinitions="Auto,*,Auto,Auto,Auto"
												  ColumnSpacing="10"
												  VerticalAlignment="Center">

												<!-- ID -->
												<Border Grid.Column="0"
														Background="#f8f9fa"
														CornerRadius="4"
														Padding="6,4"
														MinWidth="35">
													<StackPanel Orientation="Horizontal"
																VerticalAlignment="Center">
														<TextBlock Text="№"
																   FontWeight="Bold"
																   Foreground="#6c757d"
																   VerticalAlignment="Center"
																   Margin="0,0,3,0"/>
														<TextBlock Text="{Binding Id}"
																   FontWeight="Bold"
																   Foreground="#495057"
																   VerticalAlignment="Center"
																   MinWidth="20"
																   TextAlignment="Center"/>
													</StackPanel>
												</Border>

												<!-- Позиция в библиотеке -->
												<StackPanel Grid.Column="1"
															Orientation="Vertical"
															VerticalAlignment="Center">
													<TextBlock Text="Позиция"
															   FontWeight="SemiBold"
															   FontSize="11"
															   Foreground="#6c757d"
															   Margin="0,0,0,2"/>
													<TextBox Text="{Binding Location, Mode=TwoWay}"
															 Watermark="Например: Стеллаж 3, Полка 2"
															 Padding="6,5"
															 BorderBrush="#ced4da"
															 FontSize="12"/>
												</StackPanel>

												<!-- Состояние книги -->
												<StackPanel Grid.Column="2"
															Orientation="Vertical"
															VerticalAlignment="Center"
															MinWidth="110">
													<TextBlock Text="Состояние"
															   FontWeight="SemiBold"
															   FontSize="11"
															   Foreground="#6c757d"
															   Margin="0,0,0,2"/>
													<ComboBox SelectedItem="{Binding Condition, Mode=TwoWay}"
															  Padding="6,5"
															  BorderBrush="#ced4da"
															  FontSize="12">
														<ComboBox.Items>
															<x:String>New</x:String>
															<x:String>Damaged</x:String>
															<x:String>Good</x:String>
															<x:String>Excellent</x:String>
														</ComboBox.Items>
													</ComboBox>
												</StackPanel>

												<!-- Статус -->
												<StackPanel Grid.Column="3"
															Orientation="Vertical"
															VerticalAlignment="Center"
															MinWidth="110">
													<TextBlock Text="Статус"
															   FontWeight="SemiBold"
															   FontSize="11"
															   Foreground="#6c757d"
															   Margin="0,0,0,2"/>
													<ComboBox SelectedItem="{Binding Status, Mode=TwoWay}"
															  Padding="6,5"
															  BorderBrush="#ced4da"
															  FontSize="12">
														<ComboBox.Items>
															<x:String>Available</x:String>
															<x:String>Reserved</x:String>
															<x:String>CheckedOut</x:String>
														</ComboBox.Items>
													</ComboBox>
												</StackPanel>

												<!-- Кнопка удаления -->
												<Button Grid.Column="4"
														Command="{Binding $parent[ItemsControl].DataContext.DeleteNewBookCopyCommand}"
														CommandParameter="{Binding}"
														Background="#dc3545"
														Foreground="White"
														BorderBrush="#dc3545"
														Padding="10,6"
														Margin="5,0,0,0"
														VerticalAlignment="Center"
														Cursor="Hand">
													<StackPanel Orientation="Horizontal"
																VerticalAlignment="Center">
														<Path Data="M19,6.41L17.59,5 12,10.59 6.41,5 5,6.41 10.59,12 5,17.59 6.41,19 12,13.41 17.59,19 19,17.59 13.41,12z"
															  Fill="White"
															  Stretch="Uniform"
															  Width="12"
															  Height="12"
															  Margin="0,0,4,0"/>
														<TextBlock Text="Удалить"
																   FontWeight="SemiBold"
																   FontSize="11"
																   VerticalAlignment="Center"/>
													</StackPanel>
												</Button>
											</Grid>

											<!-- Результат операции -->
											<Border Grid.Row="1"
													Background="{Binding IsSuccessOperationResult, Converter={StaticResource BoolToBrush}}"
													Padding="6,4"
													CornerRadius="3"
													Opacity="0.9"
													IsVisible="{Binding StringOperationResult, Converter={StaticResource StringToBool}}">
												<TextBlock Text="{Binding StringOperationResult}"
														   Foreground="White"
														   FontWeight="SemiBold"
														   FontSize="10"
														   TextWrapping="Wrap"
														   HorizontalAlignment="Center"
														   VerticalAlignment="Center"/>
											</Border>
										</Grid>
									</Border>
								</DataTemplate>
							</ItemsControl.ItemTemplate>
						</ItemsControl>
					</StackPanel>

				</ScrollViewer>

				<!-- Подсказка если список пуст -->
				<Border Grid.Row="1"
						Background="#f8f9fa"
						CornerRadius="6"
						BorderBrush="#e9ecef"
						BorderThickness="1"
						Padding="40"
						HorizontalAlignment="Center"
						VerticalAlignment="Center"
						IsVisible="{Binding IsEmptyListBookCopies}">
					<StackPanel Orientation="Vertical"
								Spacing="10"
								HorizontalAlignment="Center">
						<TextBlock Text="📖"
								   FontSize="24"
								   HorizontalAlignment="Center"/>
						<TextBlock Text="Пока нет экземпляров"
								   HorizontalAlignment="Center"
								   FontWeight="SemiBold"
								   Foreground="#495057"/>
						<TextBlock Text="Добавьте копии в левой части, чтобы увидеть экземпляры здесь"
								   HorizontalAlignment="Center"
								   TextAlignment="Center"
								   FontSize="12"
								   Foreground="#6c757d"
								   MaxWidth="250"/>
					</StackPanel>
				</Border>
			</Grid>
		</Border>
	</Grid>
</Window>
