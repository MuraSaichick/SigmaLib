<Window xmlns="https://github.com/avaloniaui"
		xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
		xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
		xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
		xmlns:vm="clr-namespace:SigmaLib.ViewModels"
		xmlns:conv="clr-namespace:SigmaLib.Converters"
		x:Class="SigmaLib.Views.AddBookWindow"
		x:DataType="vm:AddBookViewModel"
		Title="Добавить книгу"
		WindowStartupLocation="CenterOwner"
		MinWidth="1100"
		MinHeight="500">
	<Window.Resources>
		<conv:CountToVisibilityConverter x:Key="CountToBool"/>
		<conv:StringIsNotEmptyToBoolConverter x:Key="StringToBool"/>
		<conv:BoolToBrushConverter x:Key="BoolToBrush"/>
	</Window.Resources>
	<Grid ColumnDefinitions="*,*"
		  RowDefinitions="Auto,*"
		  Margin="20"
		  ColumnSpacing="30"
		  RowSpacing="20">

		<!-- Левая часть: свойства книги -->
		<Border Grid.Column="0"
				Grid.Row="0"
				Grid.RowSpan="2"
				Padding="20"
				Background="#f8f9fa"
				CornerRadius="8"
				BorderBrush="#e9ecef"
				BorderThickness="1">
			<Grid RowDefinitions="Auto,Auto,Auto,Auto,Auto,Auto,Auto,Auto,*"
				  ColumnDefinitions="Auto,*"
				  ColumnSpacing="15"
				  RowSpacing="12">

				<!-- Заголовок -->
				<TextBlock Grid.Row="0"
						   Grid.ColumnSpan="2"
						   Text="Свойства книги"
						   FontSize="16"
						   FontWeight="Bold"
						   Margin="0,0,0,10"
						   Foreground="#212529"/>

				<TextBlock Grid.Row="1" Grid.Column="0"
						   Text="Название:"
						   VerticalAlignment="Center"/>
				<TextBox Grid.Row="1" Grid.Column="1"
						 Text="{Binding NewBook.Title}"
						 Watermark="Введите название"
						 Padding="8,6"
						 BorderBrush="#ced4da"/>

				<TextBlock Grid.Row="2" Grid.Column="0"
						   Text="Автор:"
						   VerticalAlignment="Center"/>
				<TextBox Grid.Row="2" Grid.Column="1"
						 Text="{Binding NewBook.Author}"
						 Watermark="Введите автора"
						 Padding="8,6"
						 BorderBrush="#ced4da"/>

				<TextBlock Grid.Row="3" Grid.Column="0"
						   Text="Год издания:"
						   VerticalAlignment="Center"/>
				<NumericUpDown Grid.Row="3" Grid.Column="1"
							   Value="{Binding NewBook.Year}"
							   Minimum="1000"
							   Maximum="2100"
							   FormatString="0"
							   ShowButtonSpinner="True"/>

				<TextBlock Grid.Row="4" Grid.Column="0"
						   Text="Жанр:"
						   VerticalAlignment="Center"/>
				<TextBox Grid.Row="4" Grid.Column="1"
						 Text="{Binding NewBook.Genre}"
						 Watermark="Введите жанр"
						 Padding="8,6"
						 BorderBrush="#ced4da"/>

				<TextBlock Grid.Row="5" Grid.Column="0"
						   Text="Штраф за день:"
						   VerticalAlignment="Center"
						   ToolTip.Tip="Штраф за просрочку в день"/>
				<NumericUpDown Grid.Row="5" Grid.Column="1"
							   Value="{Binding NewBook.Price}"
							   Minimum="0"
							   Maximum="100000"
							   Increment="0,5"
							   ShowButtonSpinner="True"/>

				<TextBlock Grid.Row="6" Grid.Column="0"
						   Text="Количество копий:"
						   VerticalAlignment="Center"/>
				<NumericUpDown Grid.Row="6" Grid.Column="1"
							   Value="{Binding NewBook.TotalCopies}"
							   Minimum="0"
							   Maximum="1000"
							   FormatString="0"
							   ShowButtonSpinner="True"/>

				<!-- Чекбокс можно бронировать -->
				<CheckBox Grid.Row="7"
						  Grid.Column="0"
						  Grid.ColumnSpan="2"
						  Content="Можно бронировать"
						  IsChecked="{Binding NewBook.IsReservable}"
						  VerticalAlignment="Center"
						  Margin="0,10,0,0"/>

				<!-- Кнопки -->
				<StackPanel Grid.Row="8"
							Grid.ColumnSpan="2"
							Orientation="Horizontal"
							HorizontalAlignment="Right"
							Spacing="10"
							Margin="0,25,0,0">
					<Border Grid.Row="1"
							Background="Red"
							Padding="6,5"
							CornerRadius="4"
							Opacity="0.9"
							IsVisible="{Binding ErrorMessage, Converter={StaticResource StringToBool}}"
							VerticalAlignment="Center">
						<TextBlock Text="{Binding ErrorMessage}"
								   Foreground="White"
								   FontWeight="SemiBold"
								   FontSize="10"
								   TextWrapping="Wrap"
								   HorizontalAlignment="Center"
								   VerticalAlignment="Center"/>
					</Border>
					<Button Content="Сохранить книгу"
							Command="{Binding AddBookCommand}"
							Padding="15,8"
							Background="#007bff"
							Foreground="White"
							BorderThickness="0"
							CornerRadius="4"
							Cursor="Hand"
							FontWeight="SemiBold"/>
					<Button Content="Отмена"
							Command="{Binding CancelCommand}"
							Padding="15,8"
							Background="#6c757d"
							Foreground="White"
							BorderThickness="0"
							CornerRadius="4"
							Cursor="Hand"/>
				</StackPanel>
			</Grid>
		</Border>

		<!-- Правая часть: список копий -->
		<Border Grid.Column="1"
				Grid.Row="0"
				Grid.RowSpan="2"
				Padding="20"
				Background="#f8f9fa"
				CornerRadius="8"
				BorderBrush="#e9ecef"
				BorderThickness="1">
			<Grid RowDefinitions="Auto,*">
				<!-- Заголовок -->
				<StackPanel Grid.Row="0"
							Orientation="Horizontal"
							Spacing="10"
							Margin="0,0,0,15"
							VerticalAlignment="Center">
					<TextBlock Text="📚"
							   FontSize="18"
							   VerticalAlignment="Center"/>
					<TextBlock Text="Экземпляры книги"
							   FontSize="16"
							   FontWeight="Bold"
							   VerticalAlignment="Center"
							   Foreground="#212529"/>
					<TextBlock Text="{Binding BookCopies.Count}"
							   FontSize="14"
							   FontWeight="SemiBold"
							   Foreground="#495057"
							   VerticalAlignment="Center"
							   Margin="5,0,0,0"/>
				</StackPanel>

				<!-- Список копий -->
				<ScrollViewer Grid.Row="1"
							  VerticalScrollBarVisibility="Auto"
							  HorizontalScrollBarVisibility="Disabled"
							  Padding="0,5,0,0">
					<ItemsControl ItemsSource="{Binding BookCopies}"
								  Margin="0,0,5,0">
						<ItemsControl.ItemTemplate>
							<DataTemplate>
								<Border Padding="15"
										Margin="0,0,0,10"
										Background="White"
										CornerRadius="6"
										BorderBrush="#e9ecef"
										BorderThickness="1">
									<Grid RowDefinitions="Auto,Auto"
										  RowSpacing="10">
										<Grid ColumnDefinitions="Auto,*,Auto,Auto"
											  ColumnSpacing="15"
											  VerticalAlignment="Center">

											<!-- ID -->
											<StackPanel Grid.Column="0"
														Orientation="Horizontal"
														VerticalAlignment="Center">
												<TextBlock Text="№"
														   FontWeight="Bold"
														   Foreground="#6c757d"
														   VerticalAlignment="Center"
														   Margin="0,0,5,0"/>
												<TextBlock Text="{Binding Id}"
														   FontWeight="Bold"
														   Foreground="#495057"
														   VerticalAlignment="Center"
														   MinWidth="25"
														   TextAlignment="Center"/>
											</StackPanel>

											<!-- Позиция в библиотеке -->
											<StackPanel Grid.Column="1"
														Orientation="Vertical"
														VerticalAlignment="Center">
												<TextBlock Text="Позиция"
														   FontWeight="SemiBold"
														   FontSize="12"
														   Foreground="#6c757d"
														   Margin="0,0,0,2"/>
												<TextBox Text="{Binding Location, Mode=TwoWay}"
														 Watermark="Например: Стеллаж 3, Полка 2"
														 Padding="8,6"
														 BorderBrush="#ced4da"/>
											</StackPanel>

											<!-- Состояние книги -->
											<StackPanel Grid.Column="2"
														Orientation="Vertical"
														VerticalAlignment="Center"
														Width="130">
												<TextBlock Text="Состояние"
														   FontWeight="SemiBold"
														   FontSize="12"
														   Foreground="#6c757d"
														   Margin="0,0,0,2"/>
												<ComboBox SelectedItem="{Binding Condition, Mode=TwoWay}"
														  Padding="8,6"
														  BorderBrush="#ced4da">
													<ComboBox.Items>
														<x:String>New</x:String>
														<x:String>Damaged</x:String>
														<x:String>Good</x:String>
														<x:String>Excellent</x:String>
													</ComboBox.Items>
												</ComboBox>
											</StackPanel>

											<!-- Статус -->
											<StackPanel Grid.Column="3"
														Orientation="Vertical"
														VerticalAlignment="Center"
														Width="130">
												<TextBlock Text="Статус"
														   FontWeight="SemiBold"
														   FontSize="12"
														   Foreground="#6c757d"
														   Margin="0,0,0,2"/>
												<ComboBox SelectedItem="{Binding Status, Mode=TwoWay}"
														  Padding="8,6"
														  BorderBrush="#ced4da">
													<ComboBox.Items>
														<x:String>Available</x:String>
														<x:String>Reserved</x:String>
														<x:String>CheckedOut</x:String>
													</ComboBox.Items>
												</ComboBox>
											</StackPanel>
											<!-- Результат операции для конкретного элемента -->
										</Grid>
										<Border Grid.Row="1"
												Background="{Binding IsSuccessOperationResult, Converter={StaticResource BoolToBrush}}"
												Padding="6,5"
												CornerRadius="4"
												Opacity="0.9"
												IsVisible="{Binding StringOperationResult, Converter={StaticResource StringToBool}}"
												VerticalAlignment="Center">
											<TextBlock Text="{Binding StringOperationResult}"
													   Foreground="White"
													   FontWeight="SemiBold"
													   FontSize="10"
													   TextWrapping="Wrap"
													   HorizontalAlignment="Center"
													   VerticalAlignment="Center"/>
										</Border>
									</Grid>
								</Border>
							</DataTemplate>
						</ItemsControl.ItemTemplate>
					</ItemsControl>
				</ScrollViewer>

				<!-- Подсказка если список пуст -->
				<Border Grid.Row="1"
						Background="#f8f9fa"
						CornerRadius="6"
						BorderBrush="#e9ecef"
						BorderThickness="1"
						Padding="40"
						HorizontalAlignment="Center"
						VerticalAlignment="Center"
						IsVisible="{Binding BookCopies.Count, Converter={StaticResource CountToBool}}">
					<StackPanel Orientation="Vertical"
								Spacing="10"
								HorizontalAlignment="Center">
						<TextBlock Text="📖"
								   FontSize="24"
								   HorizontalAlignment="Center"/>
						<TextBlock Text="Пока нет экземпляров"
								   HorizontalAlignment="Center"
								   FontWeight="SemiBold"
								   Foreground="#495057"/>
						<TextBlock Text="Введите количество копий в левой части, чтобы увидеть экземпляры здесь"
								   HorizontalAlignment="Center"
								   TextAlignment="Center"
								   FontSize="12"
								   Foreground="#6c757d"
								   MaxWidth="250"/>
					</StackPanel>
				</Border>
			</Grid>
		</Border>
	</Grid>
</Window>
